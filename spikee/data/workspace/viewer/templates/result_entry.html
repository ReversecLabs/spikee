{% extends "base.html" %}

{% block content %}
<div id="content" class="container">
    <div class="row justify-content-center">
        <div class="col-12 d-flex flex-column">
            <div class="card shadow-sm border-0">
                
                <!-- Dynamic Header -->
                <div class="card-header py-3 d-flex justify-content-between align-items-center 
                    {% if entry.success %}
                        bg-success text-white
                    {% elif entry.guardrail %}
                        bg-warning text-dark
                    {% else %}
                        bg-danger text-white
                    {% endif %}">

                    <h5 class="mb-0">#{{ entry.id }} | {{ entry.long_id }}</h5>

                    <span class="badge bg-white rounded-pill px-3 
                        {% if entry.success %}
                            text-success
                        {% elif entry.guardrail %}
                            text-warning-emphasis
                        {% else %}
                            text-danger
                        {% endif %}">
                        
                        {% if entry.success %}
                            PASSED
                        {% elif entry.guardrail %}
                            GUARDRAIL TRIGGER
                        {% else %}
                            FAILED
                        {% endif %}
                    </span>
                </div>

                <div class="card-body p-4">
                    
                    <!-- Metadata Grid -->
                    <div class="row g-3 mb-4">
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Language</div>
                            <div class="fw-bold">{{ entry.lang if entry.lang and entry.lang is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Jailbreak Type</div>
                                <div class="fw-bold">{{ entry.jailbreak_type if entry.jailbreak_type and entry.jailbreak_type is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Instruction Type</div>
                            <div class="fw-bold">{{ entry.instruction_type if entry.instruction_type and entry.instruction_type is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="meta-label">Document Type</div>
                            <div class="fw-bold">{{ entry.document_id if entry.document_id and entry.document_id is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Position</div>
                            <div class="fw-bold">{{ entry.position if entry.position and entry.position is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Spotlighting Marker</div>
                            <div class="fw-bold">{{ entry.spotlighting_data_markers if entry.spotlighting_data_markers and entry.spotlighting_data_markers is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3 border-end">
                            <div class="meta-label">Injection Delimiter</div>
                            <div class="fw-bold">{{ entry.injection_delimiters if entry.injection_delimiters and entry.injection_delimiters is not none else "—" }}</div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="meta-label">Suffix ID</div>
                            <div class="fw-bold">{{ entry.suffix_id if entry.suffix_id and entry.suffix_id is not none else "—" }}</div>
                        </div>
                    </div>

                    <hr>

                        {% if entry.input is string %}
                    <!-- Single-Turn Input -->
                    <div class="border-start px-3">
                        <strong class="small me-2">Input Prompt:</strong>
                        <div class="code-block h-100">{{ entry.input|e if entry.input is not none and entry.input != "" else "—" }}</div>
                    </div>

                    {% elif entry.input is mapping %}
                    <!-- Instructional Multi-Turn Input -->
                    <div class="border-start px-3">
                        <strong class="small me-2">Instructional Multi-Turn Prompt:</strong>
                        {% if entry.input.objective and entry.input.objective is not none %}
                            <div class="code-block h-100"><strong class="text-primary">Objective:</strong>{{ entry.input.objective|e }}</div>
                        {% endif %}
                        <ol class="ps-3 mt-2">
                            {% for message in entry.input.conversation %}
                                <li class="mb-2">
                                    <div class="code-block h-100"><strong class="text-success">{{ message.role|upper }}: </strong>{{ message.content|e }}</div>
                                </li>
                            {% endfor %}
                        </ol>
                    </div>

                    {% else %}
                    <!-- Multi-Turn Input -->
                    <div class="border-start px-3">
                        <strong class="small me-2">Multi-Turn Input Prompt:</strong>
                        <ol class="ps-3 mt-2">
                        {% for message in entry.input %}
                            <li class="mb-2">
                                <div class="code-block h-100">{{ message|e}}</div>
                            </li>
                        {% endfor %}
                        </ol>
                    </div>
                    {% endif %}
                    
                    {% if entry.guardrail %}
                        <!-- Guardrail -->
                        <div class="border-start px-3 mt-2 bg-warning bg-opacity-10 border-start border-warning">
                            <strong class="small me-2 text-warning-emphasis">Guardrail Categories:</strong>
                            <div class="code-block h-100">{{ entry.guardrail_categories|e if entry.guardrail_categories is not none else "—" }}</div>
                        </div>
                    {% elif entry.error and entry.error != "" %}
                        <!-- Error Message -->
                        <div class="border-start px-3 mt-2 bg-danger bg-opacity-10 border-start border-danger">
                            <strong class="small me-2 text-danger-emphasis">Error Message:</strong>
                            <div class="code-block h-100">{{ entry.error|e }}</div>
                        </div>
                    {% else %}
                        <!-- Single-Turn Response -->
                        <div class="border-start px-3 mt-2">
                            <strong class="small me-2">Response:</strong>
                            <div class="code-block h-100">{{ entry.response|e if entry.response is not none and entry.response != "" else "—" }}</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
